<!doctype html>
<html class="no-js" lang="zxx">

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>App Landing Template </title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- <link rel="manifest" href="site.webmanifest"> -->
	<link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">
	<!-- Place favicon.ico in the root directory -->

	
 <!-- CSS here -->
   <link rel="stylesheet" href="assets/css/bootstrap.min.css">
   <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
   <link rel="stylesheet" href="assets/css/slicknav.css">
   <link rel="stylesheet" href="assets/css/animate.min.css">
   <link rel="stylesheet" href="assets/css/magnific-popup.css">
   <link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
   <link rel="stylesheet" href="assets/css/themify-icons.css">
   <link rel="stylesheet" href="assets/css/slick.css">
   <link rel="stylesheet" href="assets/css/nice-select.css">
   <link rel="stylesheet" href="assets/css/style.css">
   <link rel="stylesheet" href="assets/css/responsive.css">

   <script src='assets/js/jquery.min.js'></script>
   <!-- Add some CSS so we can see the graph! -->
	<style>
		#network-graph {
      	  height: 70vh;
      	  width: 100%;
      	  padding: 0;
      	  margin: 0;
      	}
		  table {
		    display: block;
		    overflow-x: auto;
		    white-space: nowrap;
		}
  	</style>
</head>

<body>
	
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="preloader-circle"></div>
                <div class="preloader-img pere-text">
                    <!-- netrex -->
                    <img src="assets/img/logo/f1.png" alt="">
                </div>
            </div>
        </div>
    </div>
    <!-- Preloader Start -->

    <header>
        <!-- Header Start -->
       <div class="header-area header-transparrent ">
            <div class="main-header header-sticky">
                <div class="container">
                    <div class="row align-items-center">
                        <!-- Logo -->
                        <div class="col-xl-2 col-lg-2 col-md-2">
                            <div class="logo">
                                <a href="index.html"><img src="assets/img/logo/f1.png" alt="" style="width:100px"></a>
                                <!-- <div>NetREx</div> -->
                            </div>
                        </div>
                        <div class="col-xl-10 col-lg-10 col-md-10">
                            <!-- Main-menu -->
                            <div class="main-menu f-right d-none d-lg-block">
                                <nav>
                                    <ul id="navigation">    
                                        <li><a href="index.html">Home</a></li>
                                        <li><a href="elements.html">Overview</a></li>
                                        <li class="active"><a href="query.html">Visualise</a>
                                            <ul class="submenu">
                                                <li><a href="query.html/network-viewer">Network Viewer</a></li>
                                                <li><a href="query.html/module-viewer">Module Viewer</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="dataset.html">Datasets</a></li>
                                        <li><a href="contact.html">Contact</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <!-- Mobile Menu -->
                        <div class="col-12">
                            <div class="mobile_menu d-block d-lg-none"></div>
                        </div>
                    </div>
                </div>
            </div>
       </div>
        <!-- Header End -->
    </header>
	<!-- Slider Area Start-->

	<div class="services-area" style="margin-bottom: -100px;">
	</div>
	<!-- Slider Area End-->

	<!-- Start Sample Area -->
	<section class="sample-text-area">
		<div class="container">
				<div class="row">
					<div class="col-lg-8 col-md-8" style="border: 1px solid black;" id="network-graph">
						<!-- <h3 class="mb-30">Graph Area</h3> -->
					</div>


					<div class="col-lg-3 col-md-4 mt-sm-30">
						<div class="single-element-widget">
							<h3 class="mb-30">Options</h3>
							<div class="switch-wrap d-flex justify-content-between">
								<p>Original</p>
								<div class="primary-switch">
									<input type="checkbox" id="original" class="colorswitch" checked>
									<label for="original"></label>
								</div>
							</div>
							<div class="switch-wrap d-flex justify-content-between">
								<p>Module</p>
								<div class="confirm-switch">
									<input type="checkbox" id="module" class="colorswitch">
									<label for="module"></label>
								</div>
							</div>
							<div class="switch-wrap d-flex justify-content-between">
								<p>Regulation</p>
								<div class="default-select" id="regtimeHead" style="margin-top: -7px;">
									<select name="time" id="regtime">
										<option value="">- Time -</option>

									</select>
								</div>
								<div class="confirm-switch">
									<input type="checkbox" id="regulation" class="colorswitch">
									<label for="regulation"></label>
								</div>
							</div>
							
							<!-- <div class="button-group-area mt-40">
								<a href="#" class="genric-btn success circle">Force Atlas</a>
								<a href="#" class="genric-btn warning circle">Force Atlas</a>
							</div> -->

						</div>
					</div>
				</div>
		</div>
	</section>
	<!-- End Sample Area -->

	<!-- Start Table -->

	<div class="container box_1170">
		<div class="row">
			<div class="col-sm-2">
				<div class="form-group form-contact">
					<input class="form-control valid" type="text" id="searchField" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Search'" placeholder="Search">
				</div>
			</div>
			<div class="btn-group d-flex justify-content-center col-sm-6" style="padding: 5px;">
				<button class="tableswitch btn btn-primary" id="tablefunc" >Function</button>
				<button class="tableswitch btn btn-primary active" id="tabledesc" >Description</button>
				<button class="tableswitch btn btn-primary" id="tablefc" >Fold Change</button>
			</div>
			<div class="col-sm-2">
				<p>Rows per page: </p>
			</div>
			<div class="col-sm-1">
				<select name="rowsPerPage" id="changeRows">
					<option value="1">1</option>
					<option value="5" selected>5</option>
					<option value="10">10</option>
					<option value="15">15</option>
				</select>
			</div>
		</div>	

		<div id="table-sortable"></div>
	</div>
	<!-- End Table -->

	
	<footer>

		<!-- Footer Start-->
	   <div class="footer-main">
		 <div class="footer-area footer-padding">
			 <div class="container">
				 <div class="row  justify-content-between">
					 <div class="col-lg-3 col-md-4 col-sm-8">
						  <div class="single-footer-caption mb-30">
							   <!-- logo -->
							  <div class="footer-logo">
								  <a href="index.html"><img src="assets/img/logo/f1.png" alt="" style="width:100px"></a>
							  </div>
							  <div class="footer-tittle">
								  <div class="footer-pera">
									  <p class="info1">A visualizer for the correlation network of rice genes based on fold changes.</p>
								 </div>
							  </div>
						  </div>
					 </div>
					 <div class="col-lg-2 col-md-4 col-sm-5">
						 <div class="single-footer-caption mb-50">
							 <div class="footer-tittle">
								 <h4>Quick Links</h4>
								 <ul>
									 <li><a href="index.html">Home</a></li>
									 <li><a href="overview.html">About</a></li>
									 <li><a href="query.html">Visualise</a></li>
									 <li><a href="datasets.html">Datasets</a></li>
									 <li><a href="contact.html">Contact</a></li>
								 </ul>
							 </div>
						 </div>
					 </div>
					 <div class="col-lg-2 col-md-4 col-sm-7">
						 <div class="single-footer-caption mb-50">
							 <div class="footer-tittle">
								 <h4>Support</h4>
								 <ul>
									 <li><a href="contact.html">Report a bug</a></li>
									 <li><a href="contact.html">Privacy Policy</a></li>
									 <li><a href="contact.html">Terms & Conditions</a></li>
									 <li><a href="contact.html">Sitemap</a></li>
									 <li><a href="contact.html">FAQs</a></li>
								 </ul>
							 </div>
						 </div>
					 </div>
					 <div class="col-lg-3 col-md-6 col-sm-8">
						 <div class="single-footer-caption mb-50">
							 <div class="footer-tittle">
								 <h4>Newsletter</h4>
								 <div class="footer-pera footer-pera2">
								  <p>For notification for any updates please subscribe!</p>
							  </div>
							  <!-- Form -->
							  <div class="footer-form">
								  <div id="mc_embed_signup">
									  <form target="_blank" action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01" method="get" class="subscribe_form relative mail_part" novalidate="true">
										  <input type="email" name="EMAIL" id="newsletter-form-email" placeholder=" Email Address " class="placeholder hide-on-focus" onfocus="this.placeholder = ''" onblur="this.placeholder = ' Email Address '">
										  <div class="form-icon">
											  <button type="submit" name="submit" id="newsletter-submit" class="email_icon newsletter-submit button-contactForm"><img src="assets/img/shape/form_icon.png" alt=""></button>
										  </div>
										  <div class="mt-10 info"></div>
									  </form>
								  </div>
							  </div>
							 </div>
						 </div>
					 </div>
				 </div>
				 <!-- Copy-Right -->
				 <div class="row align-items-center">
					 <div class="col-xl-12 ">
						 <div class="footer-copy-right">
							<p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
   Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This application is made with <i class="ti-heart" aria-hidden="true"></i> by <a href="https://researchweb.iiit.ac.in/~mayank.musaddi" target="_blank">Mayank Musaddi</a>
   <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
						 </div>
					 </div>
				 </div>
			 </div>
		 </div>
	   </div>
		<!-- Footer End-->
 
	</footer>
</body>

<!-- All JS Custom Plugins Link Here here -->
<script src="./assets/js/vendor/modernizr-3.5.0.min.js"></script>

<!-- Jquery, Popper, Bootstrap -->
<script src="./assets/js/vendor/jquery-1.12.4.min.js"></script>
<script src="./assets/js/popper.min.js"></script>
<script src="./assets/js/bootstrap.min.js"></script>
<!-- Jquery Mobile Menu -->
<script src="./assets/js/jquery.slicknav.min.js"></script>

<!-- Jquery Slick , Owl-Carousel Plugins -->
<script src="./assets/js/owl.carousel.min.js"></script>
<script src="./assets/js/slick.min.js"></script>

<!-- One Page, Animated-HeadLin -->
<script src="./assets/js/wow.min.js"></script>
<script src="./assets/js/animated.headline.js"></script>
<script src="./assets/js/jquery.magnific-popup.js"></script>

<!-- Scrollup, nice-select, sticky -->
<script src="./assets/js/jquery.scrollUp.min.js"></script>
<script src="./assets/js/jquery.nice-select.min.js"></script>
<script src="./assets/js/jquery.sticky.js"></script>

<!-- contact js -->
<!-- <script src="./assets/js/contact.js"></script> -->
<script src="./assets/js/jquery.form.js"></script>
<script src="./assets/js/jquery.validate.min.js"></script>
<script src="./assets/js/mail-script.js"></script>
<script src="./assets/js/jquery.ajaxchimp.min.js"></script>

<!-- Jquery Plugins, main Jquery -->	
<script src="./assets/js/plugins.js"></script>
<script src="./assets/js/main.js"></script>

<!-- Non graph related JS here -->
<script src="./assets/js/table-sortable.js"></script>
<script>
	// var data={};
	
	$('.colorswitch').click(function(){
		$('.colorswitch').each(function(){
			$(this).prop('checked', false); 
		}); 
		$(this).prop('checked', true);
	});

	$('.tableswitch').click(function(){
		$('.tableswitch').each(function(){
			$(this).removeClass("active");
		}); 
		$(this).addClass("active");
	});

	function sortByTime(dict) {
		var sortedDay = [];
		var sortedHour = [];
		for(var key in dict) {
			var time = key.split(" ");
			if(time[1]=="day")
				sortedDay[sortedDay.length] = parseInt(time[0],10);
			else
				sortedHour[sortedHour.length] = parseInt(time[0],10);
		}
		sortedDay.sort((a,b)=>a-b);
		sortedHour.sort((a,b)=>a-b);

		var tempDict = {};
		for(var i = 0; i < sortedHour.length; i++) {
			var key = [sortedHour[i],"hr"].join(" ")
			tempDict[key] = dict[key];
		}
		for(var i = 0; i < sortedDay.length; i++) {
			var key = [sortedDay[i],"day"].join(" ")
			tempDict[key] = dict[key];
		}
		return tempDict;
	}

	// for adding regulation timestamps in select
	if(data.nodes.length > 0){
		const props = Object.keys(data.nodes[0].attributes);

		var timestamps= {};
		for(const prop of props){
			if(prop.substring(0,3) === "fc_"){
				var val = "reg_"+prop.substring(3);
				var txt = prop.substring(3).match(/[a-zA-Z]+|[0-9]+/g).join(" ");
				timestamps[txt]=val;
			}
		}
		timestamps = sortByTime(timestamps);

		var $el = $("#regtime");
		$el.empty(); // remove old timestamps
		$.each(timestamps, function(key,value) {
			$el.append($("<option></option>")
		   		.attr("value", value).text(key));
		});
		var $el = $("#regtimeHead > div > ul");
		$el.empty(); // remove old timestamps
		$.each(timestamps, function(key,value) {
			$el.append($("<li></li>")
		    	.attr("data-value", value).attr("class", "option").text(key));
		});
	};


	var tabledata = [];
	var columnsDesc = {
	    'label': 'Label',
	    'tf': 'TF',
	    'wgcna_modules': 'Module',
	    'description': 'Description',
	    'msu_loc': 'MSU ID'
	};
	var columnsFunc = {
		'label': 'Label',
		'go': 'GO',
		'mapman': 'Mapman',
	}
	var columnsFC = {
		'label': 'Label',
	}
	Object.keys(timestamps).forEach(function(key) {
		var time = timestamps[key].substring(4);
		columnsFC["fc_"+time] = "FC "+key;
		columnsFC["pval_"+time] = "Pval "+key;
	});

	for(var i in data.nodes){
		var label = data.nodes[i].label;
		var attr = data.nodes[i].attributes;
		attr['label'] = label;
		tabledata.push(attr);

		Object.keys(columnsDesc).forEach(function(key) {
			if (!attr.hasOwnProperty(key)) {
        		attr[key]='-';
    		}
		});

		Object.keys(columnsFunc).forEach(function(key) {
			if (!attr.hasOwnProperty(key)) {
        		attr[key]='-';
    		}
		});

		Object.keys(columnsFC).forEach(function(key) {
			if (!attr.hasOwnProperty(key)) {
        		attr[key]='-';
    		}
		});
	}

	var table = 
		$('#table-sortable').tableSortable({
		    data: tabledata,
		    columns: columnsDesc,
		    rowsPerPage: 5,
			pagination: true,
			searchField: '#searchField',
		});

	$(document).ready(()=>{
		$('#changeRows').on('change', function() {
		  table.updateRowsPerPage(parseInt($(this).val(), 10));
		})

		$("#tablefunc").click(function(){
			table.options.columns = columnsFunc;
			table.refresh(true);
		});

		$("#tablefc").click(function(){
			table.options.columns = columnsFC;
			table.refresh(true);
		});

		$("#tabledesc").click(function(){
			table.options.columns = columnsDesc;
			table.refresh(true);
		});
	});
</script>


<!-- Sigma Related JS here -->

		<!-- <script src="assets/js/jquery.min.js"></script> -->
		<script src='./sigma/sigma.min.js'></script>
    	<script src='./sigma/sigma.layout.forceAtlas2.min.js'></script>
    	<script src='./sigma/sigma.plugins.filter.js'></script>
    	<script src='./sigma/shape-library.js'></script>
    	<script src='./sigma/sigma.renderers.customShapes.js'></script>
    	<script src='./sigma/sigma.plugins.animate.js'></script>
    	<script src='./sigma/sigma.layout.noverlap.js'></script>
		
		<script>
			// Receiving data from the backend
			// var data = !{JSON.stringify(data)};

			const colors = {
			  "Black" : '#000000',
			  "Blue" : '#0000FF',
			  "Brown" : '#A52A2A',
			  "Cyan" : '#00FFFF',
			  "Green" : '#008000',
			  "GreenYellow" : '#ADFF2F',
			  "Grey" : '#808080',
			  "Grey60" : '#C0C0C0',
			  "LightCyan" : '#E0FFFF',
			  "lightGreen" : '#90EE90',
			  "lightYellow" : '#FFFFE0',
			  "Magenta" : '#FF00FF',
			  "MidnightBlue" : '#191970',
			  "Pink" : '#FFC0CB',
			  "Purple" : '#800080',
			  "Red" : '#FF0000',
			  "royalBlue" : '#4169E1',
			  "Salmon" : '#FA8072',
			  "Tan" : '#D2B48C',
			  "Turquoise" : '#40E0D0',
			  "Yellow" : '#FFFF00',
			};

			// Add a method to the graph model that returns an object with every neighbors of a node inside:
			sigma.classes.graph.addMethod('neighbors', function(nodeId) {
			  var k,
				neighbors = {},
				index = this.allNeighborsIndex[nodeId] || {};
			
			  for (k in index)
				neighbors[k] = this.nodesIndex[k];
			
			  return neighbors;
			});

			// Doesn't Work ??
			sigma.classes.graph.addMethod('reorderNodes', function (id) {
				var l = this.nodesArray.length;
				var temp = null;
				//remove node from the nodesArray
				for (let i = 0; i < l; i++)
					if (this.nodesArray[i].id === id) {
						temp = this.nodesArray.splice(i, 1);
						break;
					}
				//push the node into the end
				this.nodesArray.push(temp[0]);
				return this;
			});

			s = new sigma({ 
				graph: data,
				container: 'network-graph',
				renderer: {
				  container: document.getElementById('network-graph'),
				  type: sigma.renderers.canvas
				},
				settings: {
				  minNodeSize: 1,
				  maxNodeSize: 15,
					//- enableNodeHovering: true, ??
					//- enableEdgeHovering: true, ??
				}
			});

			filter = new sigma.plugins.filter(s);
			var selectedNode;

			var edges = s.graph.edges();
			for (var i = 0; i < edges.length; i += 1){
				edges[i].type = 'curve';
				edges[i].size = 0.1;
				//- edges[i].color = "pink";
			}

			// We first need to save the original colors of our nodes and edges, like this:
			s.graph.nodes().forEach(function(n) {
			  n.originalColor = n.color;
			  n.firstColor = n.color;
			  n.originalBorderColor = n.borderColor;
			});
			s.graph.edges().forEach(function(e) {
			  e.originalColor = e.color;
			});

			// When a node is clicked, we check for each node if it is a neighbor of the clicked one. If not, we set its color as grey, and else, it takes its original color. We do the same for the edges, and we only keep edges that have both extremities colored.
			s.bind('overNode', function(e) {
			  var nodeId = e.data.node.id,
				  toKeep = s.graph.neighbors(nodeId);
			  toKeep[nodeId] = e.data.node;
			
			  s.graph.nodes().forEach(function(n) {
				if (toKeep[n.id]){
				  n.color = n.originalColor;
				  n.borderColor = n.originalBorderColor;
				  //- s.graph.reorderNodes(n.id); ??
				}
				else{
				  n.color = '#eee';
				  n.borderColor = '#eee';
				}
			  });
		  
				s.graph.edges().forEach(function(e) {
				  if (toKeep[e.source] && toKeep[e.target])
					e.color = e.originalColor;
				  else
					e.color = '#eee';
				});
				s.refresh()
			  });
			  // When the stage is clicked, we just color each node and edge with its original color.
			  s.bind('outNode', function(e) {
				s.graph.nodes().forEach(function(n) {
				  n.color = n.originalColor;
				  n.borderColor = n.originalBorderColor;
				});
			
			  s.graph.edges().forEach(function(e) {
				e.color = e.originalColor;
			  });
		  
			});


			//Initialize nodes as a circle
			s.graph.nodes().forEach(function(node, i, a) {
				node.x = Math.cos(Math.PI * 2 * i / a.length);
				node.y = Math.sin(Math.PI * 2 * i / a.length);
			});

			//Call refresh to render the new graph
			CustomShapes.init(s);
			s.refresh();

			s.startForceAtlas2();
			setTimeout(
			  function () {
				console.log('stopping');
				s.stopForceAtlas2();
			  }, 
			  1000);
		  
			var config = {
			  nodeMargin: 3.0,
			  scaleNodes: 1.3,
			};
			// Configure the algorithm
			var listener = s.configNoverlap(config);
			// Bind all events:
			listener.bind('start stop interpolate', function(event) {
			  console.log(event.type);
			});
			// Start the algorithm:
			s.startNoverlap();

			//- console.log(data);
			console.log(s.graph.nodes());
			console.log(s.graph.edges());

			if (selectedNode != undefined){
			  s.cameras[0].goTo({x:selectedNode['read_cam0:x'],y:selectedNode['read_cam0:y'],ratio:0.1});
			};

			$(document).ready(()=>{

			  $('#original').click(()=>{
				s.graph.nodes().forEach(function(n) {
				  n.originalColor = n.firstColor;
				  n.color = n.originalColor;
				});
				s.refresh();
			  });
			  $('#module').click(()=>{
				s.graph.nodes().forEach(function(n) {
				  n.originalColor = colors[n.attributes.wgcna_modules];
				  n.color = n.originalColor;
				});
				s.refresh();
			  });

			  $('#regulation').click(()=>{
				var val = $("#regtime").val();
				s.graph.nodes().forEach(function(n) {
				  var color = colors["Grey"];
				  if(n.attributes.hasOwnProperty(val)){
					if(n.attributes[val] === "Up")
					  color = colors["Red"];
					else
					  color = colors["Blue"];
				  }
				  n.originalColor = color;
				  n.color = n.originalColor;
				});
				s.refresh();
			  });

			  $(function(){
					$('#regtime').change(function(){
						var val= $(this).val();
						var regTrigger = document.getElementById('regulation');
						if(regTrigger.checked){
							s.graph.nodes().forEach(function(n) {
				  			var color = colors["Grey"];
				  			if(n.attributes.hasOwnProperty(val)){
								if(n.attributes[val] === "Up")
								  color = colors["Red"];
								else
								  color = colors["Blue"];
				  			}
				  			n.originalColor = color;
				  			n.color = n.originalColor;
							});
						s.refresh();
						}
				    })
				    $('#regtime').trigger('change');
				});
		});
		</script>
</html>